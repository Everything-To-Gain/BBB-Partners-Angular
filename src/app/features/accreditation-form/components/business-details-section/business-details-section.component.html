<div [formGroup]="form()" class="space-y-4 sm:space-y-6">
  <div hlmCard>
    <div hlmCardHeader>
      <div hlmCardTitle class="text-lg sm:text-xl text-primary">Business Details & Licensing</div>
      <div hlmCardDescription>
        Tell us more about your business operations and legal information.
      </div>
    </div>
    <div hlmCardContent class="space-y-3 sm:space-y-4">
      <hlm-form-field>
        <label hlmLabel>Business Description *</label>
        <textarea
          hlmInput
          placeholder="We provide residential and commercial roofing services including installations, repairs, and inspections."
          class="min-h-[100px]"
          formControlName="businessDescription"
        ></textarea>
        <hlm-error>Business description is required</hlm-error>
      </hlm-form-field>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
        <hlm-form-field>
          <label hlmLabel>EIN (Employer Identification Number)</label>
          <input hlmInput placeholder="12-3456789" formControlName="ein" />
        </hlm-form-field>
        <hlm-form-field>
          <label hlmLabel>SSN (Social Security Number)</label>
          <input hlmInput placeholder="12-3456789" formControlName="ssn" />
        </hlm-form-field>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
        <div>
          <label hlmLabel class="mb-2">Type of Business</label>
          <brn-popover
            [state]="state()"
            (stateChanged)="stateChanged($event)"
            sideOffset="5"
            class="w-full"
          >
            <button
              type="button"
              [class]="
                'w-full justify-between ' +
                (form().get('businessType')?.invalid && form().get('businessType')?.touched
                  ? '!border-destructive !border-1'
                  : '')
              "
              id="edit-profile"
              variant="outline"
              brnPopoverTrigger
              (click)="state.set('open')"
              hlmBtn
            >
              {{ currentTob() ? currentTob()?.name : 'Select Type of Business...' }}
              <ng-icon hlm size="sm" name="lucideChevronsUpDown" class="opacity-50" />
            </button>
            <hlm-command *brnPopoverContent="let ctx" hlmPopoverContent class="w-full p-0">
              <hlm-command-search>
                <ng-icon hlm name="lucideSearch" />
                <input
                  placeholder="Search Type of Business..."
                  class="placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none disabled:cursor-not-allowed disabled:opacity-50"
                  (input)="commandSearch($event.target.value)"
                />
              </hlm-command-search>
              <div *brnCommandEmpty hlmCommandEmpty>No results found.</div>
              <hlm-command-list>
                <hlm-command-group>
                  @for (tob of tobItems(); track tob.cbbbId) {
                  <button
                    type="button"
                    hlm-command-item
                    [value]="tob.cbbbId"
                    (selected)="commandSelected(tob)"
                  >
                    <span>{{ tob.name }}</span>
                    <ng-icon
                      hlm
                      class="ml-auto"
                      [class.opacity-0]="currentTob()?.cbbbId !== tob.cbbbId"
                      name="lucideCheck"
                      hlmCommandIcon
                    />
                  </button>
                  }
                </hlm-command-group>
              </hlm-command-list>
            </hlm-command>
          </brn-popover>
          @if (form().get('businessType')?.invalid && form().get('businessType')?.touched) {
          <hlm-error class="mt-2">Type of business is required</hlm-error>
          }
        </div>
        <hlm-form-field>
          <label hlmLabel>Incorporation Details</label>
          <input
            hlmInput
            placeholder="Incorporated on 01/01/2015 in California"
            formControlName="incorporationDetails"
          />
        </hlm-form-field>
      </div>
      <hlm-form-field>
        <label hlmLabel>Business Entity Type *</label>
        <brn-select
          class="inline-block w-full"
          placeholder="Select some entity types"
          [multiple]="true"
          formControlName="businessEntityType"
        >
          <hlm-select-trigger class="w-full">
            <hlm-select-value />
          </hlm-select-trigger>
          <hlm-select-content>
            <hlm-option value="Corporation">Corporation</hlm-option>
            <hlm-option value="Limited Liability Company (LLC)"
              >Limited Liability Company (LLC)</hlm-option
            >
            <hlm-option value="Limited Partnership (LP)">Limited Partnership (LP)</hlm-option>
            <hlm-option value="S. Corp">S. Corp</hlm-option>
            <hlm-option value="Other">Other</hlm-option>
          </hlm-select-content>
        </brn-select>
        <hlm-error>Business entity type is required</hlm-error>
      </hlm-form-field>
    </div>
  </div>

  <div hlmCard>
    <div hlmCardHeader>
      <div hlmCardTitle class="text-lg">Licenses & Certifications</div>
      <div hlmCardDescription>Professional licenses and certifications for your business.</div>
    </div>
    <div hlmCardContent class="space-y-3 sm:space-y-4">
      <hlm-form-field>
        <label hlmLabel>State Business License *</label>
        <input
          hlmInput
          placeholder="CA-987654321 (Issued by CSLB on 01/01/2020)"
          formControlName="stateBusinessLicense"
        />
        <hlm-error>State business license is required</hlm-error>
      </hlm-form-field>
      <hlm-form-field>
        <label hlmLabel>Professional License</label>
        <input
          hlmInput
          placeholder="CA-PL-123456 (Issued by CSLB, Exp: 01/01/2026)"
          formControlName="professionalLicense"
        />
        <hlm-error>Professional license is required</hlm-error>
      </hlm-form-field>
    </div>
  </div>

  <div hlmCard>
    <div hlmCardHeader>
      <div hlmCardTitle class="text-lg">Business Scale & Operations</div>
      <div hlmCardDescription>Information about your business size and customer base.</div>
    </div>
    <div hlmCardContent class="space-y-3 sm:space-y-4">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
        <hlm-form-field>
          <label hlmLabel>Number of Employees *</label>
          <brn-select
            class="inline-block w-full"
            placeholder="Select employee count"
            formControlName="numberOfEmployees"
          >
            <hlm-select-trigger class="w-full">
              <hlm-select-value />
            </hlm-select-trigger>
            <hlm-select-content>
              <hlm-option value="1-5">1-5 employees</hlm-option>
              <hlm-option value="6-10">6-10 employees</hlm-option>
              <hlm-option value="11-25">11-25 employees</hlm-option>
              <hlm-option value="26-50">26-50 employees</hlm-option>
              <hlm-option value="51-100">51-100 employees</hlm-option>
              <hlm-option value="100+">100+ employees</hlm-option>
            </hlm-select-content>
          </brn-select>
          <hlm-error>Number of employees is required</hlm-error>
        </hlm-form-field>
        <hlm-form-field>
          <label hlmLabel>Gross Annual Revenue *</label>
          <brn-select
            class="inline-block w-full"
            placeholder="Select revenue range"
            formControlName="grossAnnualRevenue"
          >
            <hlm-select-trigger class="w-full">
              <hlm-select-value />
            </hlm-select-trigger>
            <hlm-select-content>
              <hlm-option value="0-50k">0-50k</hlm-option>
              <hlm-option value="50k-100k">50k-100k</hlm-option>
              <hlm-option value="100k-250k">100k-250k</hlm-option>
              <hlm-option value="250k-500k">250k-500k</hlm-option>
              <hlm-option value="500k-1m">500k-1m</hlm-option>
              <hlm-option value="1m+">1m+</hlm-option>
            </hlm-select-content>
          </brn-select>
          <hlm-error>Gross annual revenue is required</hlm-error>
        </hlm-form-field>
      </div>

      <hlm-form-field>
        <label hlmLabel>Average Customers Per Year *</label>
        <brn-select
          class="inline-block w-full"
          placeholder="Select customer range"
          formControlName="avgCustomersPerYear"
        >
          <hlm-select-trigger class="w-full">
            <hlm-select-value />
          </hlm-select-trigger>
          <hlm-select-content>
            <hlm-option value="0-50">0-50 customers</hlm-option>
            <hlm-option value="51-100">51-100 customers</hlm-option>
            <hlm-option value="101-250">101-250 customers</hlm-option>
            <hlm-option value="251-500">251-500 customers</hlm-option>
            <hlm-option value="501-1000">501-1,000 customers</hlm-option>
            <hlm-option value="1000+">1,000+ customers</hlm-option>
          </hlm-select-content>
        </brn-select>
        <hlm-error>Average customers per year is required</hlm-error>
      </hlm-form-field>
    </div>
  </div>
</div>
