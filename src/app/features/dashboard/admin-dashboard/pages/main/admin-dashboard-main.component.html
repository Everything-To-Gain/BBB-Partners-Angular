<!-- Enhanced Header -->
<app-dashboard-header
  [title]="'Admin Dashboard'"
  [subtitle]="'Manage representatives, roles and access'"
></app-dashboard-header>

<div class="w-full min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-6">
  <div class="w-full max-w-7xl mx-auto">
    <div>
      <div
        class="bg-gradient-to-r from-card/80 to-card/60 backdrop-blur-sm rounded-2xl border border-border/50 p-6 shadow-lg relative overflow-hidden mb-8"
      >
        <!-- Background decoration -->

        <div class="relative z-10 mb-6 flex items-start justify-between">
          <div class="space-y-1">
            <h2
              class="text-2xl font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent"
            >
              Admin Representatives
            </h2>
            <p class="text-sm text-muted-foreground/80 font-medium">
              Manage access, roles and status for representatives
            </p>
          </div>
          <div class="flex items-center gap-4 self-center">
            <div
              class="flex items-center gap-2 bg-background/50 px-3 py-2 rounded-xl border border-border/40"
            >
              <svg
                class="w-4 h-4 text-primary"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-foreground">{{ totalUsers() }} users</span>
            </div>
            <button
              hlmBtn
              variant="outline"
              size="sm"
              (click)="clearAllFilters()"
              class="text-muted-foreground/80 hover:text-foreground border-muted-foreground/40 hover:border-destructive/40 hover:bg-destructive/5 px-4 py-2 rounded-xl font-medium transition-all duration-200 flex items-center gap-2"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
              </svg>
              Clear All
            </button>
          </div>
        </div>
        <!-- Enhanced Filters -->
        <div class="relative z-10 space-y-6">
          <div class="flex items-end justify-between gap-6">
            <div class="flex items-end gap-6 flex-1">
              <!-- Search Input -->
              <div class="flex-1 max-w-md">
                <label class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                  <svg
                    class="w-4 h-4 text-primary"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    ></path>
                  </svg>
                  Search By <span class="text-primary font-bold">Email</span>
                </label>
                <div class="relative group">
                  <svg
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground/60 group-focus-within:text-primary transition-colors duration-200"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    ></path>
                  </svg>
                  <input
                    hlmInput
                    type="text"
                    placeholder="Search users..."
                    (input)="onSearchChange($event)"
                    class="pl-12 pr-12 w-full bg-background/50 border-border/60 focus:border-primary/50 focus:ring-primary/20 rounded-xl transition-all duration-200"
                  />
                  @if (searchTerm()) {
                  <button
                    hlmBtn
                    variant="ghost"
                    size="sm"
                    (click)="searchTerm.set(''); pageNumber.set(1); loadUsers()"
                    class="absolute right-3 top-1/2 transform -translate-y-1/2 w-7 h-7 p-0 text-muted-foreground/60 hover:text-foreground hover:bg-destructive/10 rounded-lg transition-all duration-200"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"
                      ></path>
                    </svg>
                  </button>
                  }
                </div>
              </div>

              <!-- Admin Filter -->
              <div class="flex-shrink-0">
                <label class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                  <svg
                    class="w-4 h-4 text-destructive"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  Admin
                </label>
                <brn-select
                  class="inline-block"
                  [ngModel]="isAdmin()"
                  (ngModelChange)="onAdminFilterChange($event)"
                >
                  <hlm-select-trigger
                    class="w-40 inline-flex h-10 text-sm bg-background/50 border-border/60 focus:border-destructive/50 focus:ring-destructive/20 rounded-xl transition-all duration-200"
                  >
                    <hlm-select-value placeholder="All" />
                  </hlm-select-trigger>
                  <hlm-select-content
                    class="max-h-60 rounded-xl border-border/60 bg-card/95 backdrop-blur-sm"
                  >
                    <hlm-option [value]="null">All</hlm-option>
                    <hlm-option [value]="true">Admin</hlm-option>
                    <hlm-option [value]="false">Non-admin</hlm-option>
                  </hlm-select-content>
                </brn-select>
              </div>

              <!-- CSV Sync Filter -->
              <div class="flex-shrink-0">
                <label class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                  <svg
                    class="w-4 h-4 text-blue-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                    ></path>
                  </svg>
                  CSV Sync
                </label>
                <brn-select
                  class="inline-block"
                  [ngModel]="isCSVSync()"
                  (ngModelChange)="onCsvSyncFilterChange($event)"
                >
                  <hlm-select-trigger
                    class="w-40 inline-flex h-10 text-sm bg-background/50 border-border/60 focus:border-blue-500/50 focus:ring-blue-500/20 rounded-xl transition-all duration-200"
                  >
                    <hlm-select-value placeholder="All" />
                  </hlm-select-trigger>
                  <hlm-select-content
                    class="max-h-60 rounded-xl border-border/60 bg-card/95 backdrop-blur-sm"
                  >
                    <hlm-option [value]="null">All</hlm-option>
                    <hlm-option [value]="true">Enabled</hlm-option>
                    <hlm-option [value]="false">Disabled</hlm-option>
                  </hlm-select-content>
                </brn-select>
              </div>

              <!-- Status Filter -->
              <div class="flex-shrink-0">
                <label class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
                  <svg
                    class="w-4 h-4 text-success"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  Status
                </label>
                <brn-select
                  class="inline-block"
                  [ngModel]="isActive()"
                  (ngModelChange)="onActiveFilterChange($event)"
                >
                  <hlm-select-trigger
                    class="w-40 inline-flex h-10 text-sm bg-background/50 border-border/60 focus:border-success/50 focus:ring-success/20 rounded-xl transition-all duration-200"
                  >
                    <hlm-select-value placeholder="All" />
                  </hlm-select-trigger>
                  <hlm-select-content
                    class="max-h-60 rounded-xl border-border/60 bg-card/95 backdrop-blur-sm"
                  >
                    <hlm-option [value]="null">All</hlm-option>
                    <hlm-option [value]="true">Active</hlm-option>
                    <hlm-option [value]="false">Inactive</hlm-option>
                  </hlm-select-content>
                </brn-select>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <!-- Dialog-based Add User -->
              <hlm-dialog>
                <button
                  brnDialogTrigger
                  (click)="openAddUser()"
                  class="flex items-center gap-2 bg-gradient-to-r from-primary/10 to-primary/5 rounded-lg px-3 py-2 backdrop-blur-sm border border-primary/20 shadow-sm hover:from-primary/15 hover:to-primary/10 transition-all duration-200 text-primary hover:text-primary/80 text-xs font-medium mb-1"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4v16m8-8H4"
                    />
                  </svg>
                  Add user
                </button>
                <hlm-dialog-content *brnDialogContent="let ctx" class="w-[720px] max-w-[720px]">
                  <hlm-dialog-header>
                    <h3 brnDialogTitle hlm class="text-lg">Add representative</h3>
                    <p brnDialogDescription hlm class="text-sm text-muted-foreground">
                      Provide email and roles for the user. You can modify roles later.
                    </p>
                  </hlm-dialog-header>
                  <div class="border-b border-border my-3"></div>
                  <div class="space-y-4 mt-1">
                    <div class="space-y-1">
                      <label class="text-sm font-medium text-foreground">Email</label>
                      <input
                        hlmInput
                        [ngModel]="addEmail()"
                        (ngModelChange)="addEmail.set($event)"
                        type="email"
                        placeholder="name@example.com"
                        class="w-full"
                      />
                      @if (!addEmailValid() && addEmail()) {
                      <p class="text-xs text-destructive mt-1">Please enter a valid email.</p>
                      }
                    </div>
                    <div class="space-y-2">
                      <div class="text-sm font-medium text-foreground">Roles</div>
                      <div class="grid grid-cols-1 gap-2">
                        <label class="flex items-center gap-2">
                          <hlm-checkbox
                            [ngModel]="addIsAdmin()"
                            (ngModelChange)="addIsAdmin.set($event)"
                          ></hlm-checkbox>
                          <span class="text-sm">Admin Role</span>
                        </label>
                        <label class="flex items-center gap-2">
                          <hlm-checkbox
                            [ngModel]="addIsCsvSync()"
                            (ngModelChange)="addIsCsvSync.set($event)"
                          ></hlm-checkbox>
                          <span class="text-sm">CSV Sync Role</span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="border-t border-border mt-4"></div>
                  <hlm-dialog-footer>
                    <button hlmBtn variant="outline" brnDialogClose [disabled]="addSubmitting()">
                      Cancel
                    </button>
                    <button hlmBtn (click)="submitAddUser()" [disabled]="!canSubmitAdd()">
                      Add
                    </button>
                  </hlm-dialog-footer>
                </hlm-dialog-content>
              </hlm-dialog>
              <!-- Dialog-based Bulk Add -->
              <hlm-dialog>
                <button
                  brnDialogTrigger
                  (click)="openBulkAdd()"
                  class="flex items-center gap-2 bg-gradient-to-r from-accent/10 to-accent/5 rounded-lg px-3 py-2 backdrop-blur-sm border border-accent/20 shadow-sm hover:from-accent/15 hover:to-accent/10 transition-all duration-200 text-accent hover:text-accent/80 text-xs font-medium mb-1"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                    />
                  </svg>
                  Bulk add
                </button>
                <hlm-dialog-content *brnDialogContent="let ctx" class="w-[720px] max-w-[720px]">
                  <hlm-dialog-header>
                    <h3 brnDialogTitle hlm class="text-lg">Bulk add representatives</h3>
                    <p brnDialogDescription hlm class="text-sm text-muted-foreground">
                      Enter one user per line in format: email;csvsync
                    </p>
                  </hlm-dialog-header>
                  <div class="border-b border-border my-3"></div>
                  <div class="space-y-3 mt-1">
                    <div>
                      <label class="text-sm font-medium text-foreground">Users</label>
                      <textarea
                        hlmInput
                        rows="8"
                        class="w-full font-mono text-xs mt-1 min-h-24"
                        [ngModel]="bulkText()"
                        (ngModelChange)="bulkText.set($event)"
                        placeholder="user1@gmail.com;csvsync&#10;user2@gmail.com&#10;user3@gmail.com;csvsync"
                      ></textarea>
                    </div>
                    <div class="p-3 rounded-lg bg-muted/50 border border-border">
                      <div class="text-xs font-medium text-foreground mb-2">Format examples:</div>
                      <ul class="text-xs text-muted-foreground space-y-1 list-disc pl-5">
                        <li>
                          <code class="bg-background px-1 py-0.5 rounded"
                            >user@gmail.com;csvsync</code
                          >
                          - User with CSV Sync role
                        </li>
                        <li>
                          <code class="bg-background px-1 py-0.5 rounded">user@gmail.com</code> -
                          User without CSV Sync role
                        </li>
                        <li>One user per line</li>
                        <li>Separate email and role with semicolon</li>
                        <li>Only 'csvsync' role is supported</li>
                      </ul>
                    </div>
                  </div>
                  <div class="border-t border-border mt-4"></div>
                  <hlm-dialog-footer>
                    <button hlmBtn variant="outline" brnDialogClose [disabled]="bulkSubmitting()">
                      Cancel
                    </button>
                    <button hlmBtn (click)="submitBulkAdd()" [disabled]="!canSubmitBulk()">
                      Add users
                    </button>
                  </hlm-dialog-footer>
                </hlm-dialog-content>
              </hlm-dialog>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Table -->
      <div
        class="bg-gradient-to-r from-card/90 to-card/80 backdrop-blur-sm rounded-2xl border border-border/50 overflow-hidden w-full shadow-xl relative max-w-full"
      >
        <!-- Table decoration -->

        <div class="w-full overflow-x-auto">
          <table hlmTable class="w-full min-w-max">
            <thead
              hlmTHead
              class="bg-gradient-to-r from-primary to-primary/90 text-primary-foreground hover:bg-primary/95 transition-all duration-200"
            >
              <tr hlmTr>
                @for (column of table.getAllColumns(); track column.id) {
                <th
                  hlmTh
                  class="text-white font-bold px-4 py-4 text-left text-xs uppercase tracking-wider hover:bg-primary/80 transition-all duration-200 relative group"
                >
                  <div class="flex items-center gap-2">
                    {{ column.columnDef.header }}
                    <svg
                      class="w-3 h-3 opacity-60 group-hover:opacity-100 transition-opacity duration-200"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
                      ></path>
                    </svg>
                  </div>
                </th>
                }
              </tr>
            </thead>
            <tbody hlmTBody class="bg-card/50 divide-y divide-border/30">
              @if (isLoading()) { @for (i of getSkeletonRows(); track $index) {
              <tr hlmTr class="animate-pulse">
                @for (column of table.getAllColumns(); track column.id) {
                <td hlmTd class="px-4 py-4">
                  <div class="h-4 bg-gradient-to-r from-muted/60 to-muted/40 rounded-lg w-24"></div>
                </td>
                }
              </tr>
              } } @else if (table.getRowModel().rows.length) { @for (row of
              table.getRowModel().rows; track row.id) {
              <tr
                hlmTr
                class="hover:bg-gradient-to-r hover:from-secondary/30 hover:to-secondary/10 transition-all duration-200 group"
              >
                @for (cell of row.getVisibleCells(); track cell.id) {
                <td
                  hlmTd
                  class="px-4 py-4 text-sm text-foreground align-middle whitespace-nowrap border-border/20"
                >
                  @switch (cell.column.id) { @case ('email') {
                  <span
                    class="font-semibold text-foreground group-hover:text-primary transition-colors duration-200"
                    >{{ cell.getValue() ?? '-' }}</span
                  >
                  } @case ('isAdmin') {
                  <span
                    class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold shadow-sm"
                    [class]="
                      cell.getValue()
                        ? 'bg-gradient-to-r from-destructive/15 to-destructive/10 text-destructive border border-destructive/30'
                        : 'bg-muted text-muted-foreground'
                    "
                  >
                    {{ cell.getValue() ? 'Yes' : 'No' }}
                  </span>
                  } @case ('isCSVSync') {
                  <span
                    class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold shadow-sm"
                    [class]="
                      cell.getValue()
                        ? 'bg-gradient-to-r from-primary/15 to-primary/10 text-primary border border-primary/30'
                        : 'bg-muted text-muted-foreground'
                    "
                  >
                    {{ cell.getValue() ? 'Yes' : 'No' }}
                  </span>
                  } @case ('isActive') {
                  <span
                    class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold shadow-sm"
                    [class]="
                      cell.getValue()
                        ? 'bg-gradient-to-r from-success/15 to-success/10 text-success border border-success/30'
                        : 'bg-gradient-to-r from-warning/15 to-warning/10 text-warning border border-warning/30'
                    "
                  >
                    {{ cell.getValue() ? 'Active' : 'Inactive' }}
                  </span>
                  } @case ('actions') {
                  <div class="flex items-center gap-3">
                    @if (row.original.isActive) {
                    <button
                      (click)="toggleActive(row.original)"
                      [disabled]="togglingActive().has(row.original.userId)"
                      class="flex items-center gap-2 bg-gradient-to-r from-destructive/10 to-destructive/5 rounded-xl px-3 py-2 backdrop-blur-sm border border-destructive/20 shadow-sm hover:from-destructive/15 hover:to-destructive/10 transition-all duration-200 text-destructive hover:text-destructive/80 disabled:opacity-50 disabled:cursor-not-allowed text-xs font-medium w-28 justify-center"
                    >
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M6 18L18 6M6 6l12 12"
                        />
                      </svg>
                      Deactivate
                    </button>
                    } @else {
                    <button
                      (click)="toggleActive(row.original)"
                      [disabled]="togglingActive().has(row.original.userId)"
                      class="flex items-center gap-2 bg-gradient-to-r from-success/10 to-success/5 rounded-xl px-3 py-2 backdrop-blur-sm border border-success/20 shadow-sm hover:from-success/15 hover:to-success/10 transition-all duration-200 text-success hover:text-success/80 disabled:opacity-50 disabled:cursor-not-allowed text-xs font-medium w-28 justify-center"
                    >
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M5 13l4 4L19 7"
                        />
                      </svg>
                      Activate
                    </button>
                    }
                    <hlm-dialog>
                      <button
                        brnDialogTrigger
                        class="flex items-center gap-2 bg-gradient-to-r from-primary/10 to-primary/5 rounded-xl px-3 py-2 backdrop-blur-sm border border-primary/20 shadow-sm hover:from-primary/15 hover:to-primary/10 transition-all duration-200 text-primary hover:text-primary/80 disabled:opacity-50 disabled:cursor-not-allowed text-xs font-medium w-20 justify-center"
                        (click)="openEdit(row.original)"
                      >
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 20h4l10.5-10.5a2.121 2.121 0 10-3-3L5 17v3z"
                          />
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M13.5 6.5l4 4"
                          />
                        </svg>
                        Edit
                      </button>
                      <hlm-dialog-content
                        *brnDialogContent="let ctx"
                        class="w-[720px] max-w-[720px]"
                      >
                        <hlm-dialog-header>
                          <h3 brnDialogTitle hlm class="text-lg">Edit user</h3>
                          <p brnDialogDescription hlm class="text-sm text-muted-foreground">
                            Update email and CSV Sync role for this representative
                          </p>
                        </hlm-dialog-header>
                        <div class="border-b border-border my-3"></div>
                        <div class="space-y-4 mt-1">
                          <div>
                            <label class="text-sm font-medium text-foreground">Email</label>
                            <input
                              hlmInput
                              [ngModel]="editEmail()"
                              (ngModelChange)="editEmail.set($event)"
                              type="email"
                              placeholder="name@example.com"
                              class="mt-1 w-full"
                            />
                          </div>
                          <div>
                            <div class="text-sm font-medium text-foreground mb-2">
                              CSV Sync Role
                            </div>
                            <label class="flex items-center gap-2">
                              <hlm-checkbox
                                [ngModel]="editIsCsvSync()"
                                (ngModelChange)="editIsCsvSync.set($event)"
                              ></hlm-checkbox>
                              <span class="text-sm">Enable CSV Sync</span>
                            </label>
                          </div>
                        </div>
                        <div class="border-t border-border mt-4"></div>
                        <hlm-dialog-footer>
                          <button
                            hlmBtn
                            variant="outline"
                            brnDialogClose
                            [disabled]="editSubmitting()"
                          >
                            Cancel
                          </button>
                          <button hlmBtn (click)="submitEdit()" [disabled]="!canSubmitEdit()">
                            Save changes
                          </button>
                        </hlm-dialog-footer>
                      </hlm-dialog-content>
                    </hlm-dialog>
                    <hlm-dialog>
                      <button
                        brnDialogTrigger
                        class="flex items-center gap-2 bg-gradient-to-r from-destructive/10 to-destructive/5 rounded-xl px-3 py-2 backdrop-blur-sm border border-destructive/20 shadow-sm hover:from-destructive/15 hover:to-destructive/10 transition-all duration-200 text-destructive hover:text-destructive/80 disabled:opacity-50 disabled:cursor-not-allowed text-xs font-medium w-20 justify-center"
                        (click)="openDelete(row.original)"
                      >
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 7h12"
                          />
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2"
                          />
                          <rect x="6" y="7" width="12" height="14" rx="2" ry="2" stroke-width="2" />
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 11v6M14 11v6"
                          />
                        </svg>
                        Delete
                      </button>
                      <hlm-dialog-content
                        *brnDialogContent="let ctx"
                        class="w-[560px] max-w-[560px]"
                      >
                        <hlm-dialog-header class="text-center">
                          <div class="flex justify-center mb-2">
                            <div
                              class="h-10 w-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center"
                            >
                              !
                            </div>
                          </div>
                          <h3 brnDialogTitle hlm class="text-lg">Delete User</h3>
                          <p brnDialogDescription hlm class="text-sm text-muted-foreground">
                            Are you sure you want to delete user {{ deleteEmail() }}? This action
                            cannot be undone.
                          </p>
                        </hlm-dialog-header>
                        <hlm-dialog-footer class="justify-center gap-3">
                          <button hlmBtn variant="outline" brnDialogClose [disabled]="deleting()">
                            Cancel
                          </button>
                          <button
                            hlmBtn
                            variant="destructive"
                            (click)="submitDelete()"
                            [disabled]="deleting()"
                          >
                            Delete
                          </button>
                        </hlm-dialog-footer>
                      </hlm-dialog-content>
                    </hlm-dialog>
                    <button
                      (click)="onSyncTraffic(row.original.email)"
                      [disabled]="isSyncing(row.original.email)"
                      class="flex items-center gap-2 bg-gradient-to-r from-accent/10 to-accent/5 rounded-xl px-3 py-2 backdrop-blur-sm border border-accent/20 shadow-sm hover:from-accent/15 hover:to-accent/10 transition-all duration-200 text-accent hover:text-accent/80 disabled:opacity-50 disabled:cursor-not-allowed text-xs font-medium w-20 justify-center"
                    >
                      @if (isSyncing(row.original.email)) {
                      <svg
                        class="w-3 h-3 animate-spin"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                        />
                      </svg>
                      Syncing... } @else {
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                        />
                      </svg>
                      Sync }
                    </button>
                  </div>
                  } @default {
                  <span>{{ cell.getValue() ?? '-' }}</span>
                  } }
                </td>
                }
              </tr>
              } } @else {
              <tr hlmTr>
                <td
                  hlmTd
                  class="px-4 py-12 text-center"
                  [attr.colspan]="table.getAllColumns().length"
                >
                  <div class="flex flex-col items-center gap-4">
                    <div class="relative">
                      <div
                        class="h-16 w-16 rounded-2xl bg-gradient-to-br from-primary/10 to-accent/10 flex items-center justify-center shadow-lg"
                      >
                        <svg
                          class="w-8 h-8 text-primary"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"
                          ></path>
                        </svg>
                      </div>
                      <div
                        class="absolute -top-1 -right-1 h-6 w-6 rounded-full bg-gradient-to-br from-accent to-primary flex items-center justify-center"
                      >
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                          <path
                            fill-rule="evenodd"
                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                            clip-rule="evenodd"
                          ></path>
                        </svg>
                      </div>
                    </div>
                    <div class="text-center space-y-2">
                      <div class="text-lg font-semibold text-foreground">No users found</div>
                      <div class="text-sm text-muted-foreground">
                        Try adjusting search or filters
                      </div>
                    </div>
                    <button
                      hlmBtn
                      variant="outline"
                      size="sm"
                      class="mt-2"
                      (click)="
                        searchTerm.set('');
                        isAdmin.set(null);
                        isCSVSync.set(null);
                        isActive.set(null);
                        pageNumber.set(1);
                        loadUsers()
                      "
                    >
                      Clear filters
                    </button>
                  </div>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <!-- Enhanced Pagination -->
      <div
        class="mt-6 bg-gradient-to-r from-card/80 to-card/60 backdrop-blur-sm rounded-2xl border border-border/50 p-6 shadow-lg relative overflow-hidden"
      >
        <!-- Background decoration -->

        <div class="relative z-10 flex flex-col justify-between sm:flex-row sm:items-center gap-4">
          @if (totalUsers() > 0) {
          <div class="flex items-center gap-4">
            <div
              class="flex items-center gap-2 bg-background/50 px-3 py-2 rounded-xl border border-border/40"
            >
              <svg
                class="w-4 h-4 text-primary"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-foreground">
                Showing {{ pageNumber() * pageSize() - pageSize() + 1 }} to
                {{ Math.min(pageNumber() * pageSize(), totalUsers()) }} of {{ totalUsers() }} users
              </span>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-3">
              <span class="text-sm font-medium text-muted-foreground">Show:</span>
              <brn-select
                class="inline-block"
                [ngModel]="pageSize()"
                (ngModelChange)="onPageSizeChange($event)"
              >
                <hlm-select-trigger
                  class="w-24 h-9 inline-flex text-sm bg-background/50 border-border/60 focus:border-primary/50 focus:ring-primary/20 rounded-xl transition-all duration-200"
                >
                  <hlm-select-value />
                </hlm-select-trigger>
                <hlm-select-content class="rounded-xl border-border/60 bg-card/95 backdrop-blur-sm">
                  @for (size of availablePageSizes; track size) {
                  <hlm-option [value]="size">{{ size }}</hlm-option>
                  }
                </hlm-select-content>
              </brn-select>
            </div>
            <div class="flex items-center gap-2">
              <button
                hlmBtn
                variant="outline"
                size="sm"
                [disabled]="!canPreviousPage()"
                (click)="previousPage()"
                class="h-9 px-4 rounded-xl border-border/60 hover:border-primary/50 hover:bg-primary/5 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-medium"
              >
                Previous
              </button>
              <span
                class="bg-background/50 px-4 py-2 rounded-xl border border-border/40 text-sm font-medium text-foreground"
              >
                Page {{ pageNumber() }} of {{ pageCount() }}
              </span>
              <button
                hlmBtn
                variant="outline"
                size="sm"
                [disabled]="!canNextPage()"
                (click)="nextPage()"
                class="h-9 px-4 rounded-xl border-border/60 hover:border-primary/50 hover:bg-primary/5 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-medium"
              >
                Next
              </button>
            </div>
          </div>
          } @else {
          <div class="flex h-full w-full items-center justify-center py-8">
            <div class="flex items-center gap-3">
              <div
                class="h-12 w-12 rounded-2xl bg-gradient-to-br from-muted/20 to-muted/10 flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-muted-foreground"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                  ></path>
                </svg>
              </div>
              <div class="text-muted-foreground text-sm font-medium">No results</div>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
