<!-- Enhanced Application Header -->
<header
  class="bg-gradient-to-r from-primary/8 via-background to-primary/8 border-b border-border/50 shadow-lg backdrop-blur-sm relative"
>
  <div class="container mx-auto max-w-4xl px-3 sm:px-4 lg:px-6 py-5 sm:py-7 relative">
    <div class="flex items-center justify-between">
      <!-- Logo and Title Section -->
      <div class="flex items-center gap-3 sm:gap-4 flex-1">
        <div
          class="w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-primary to-primary/80 rounded-2xl flex items-center justify-center shadow-xl transform hover:scale-105 hover:rotate-3 transition-all duration-300 relative overflow-hidden group"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0.5 0.5 266.4 368.6"
            aria-hidden="true"
            focusable="false"
            class="h-8 w-8 sm:h-9 sm:w-9 text-white drop-shadow-sm relative z-10"
          >
            <path
              fill="currentColor"
              d="M185.1 231.5H44l-5.2 16.9h37.7l7.2 23.2h61.9l7.1-23.2h37.6l-5-17zM67 136.6a33.4 33.4 0 0 0 7.4 46.7l33.8 24.5a8.4 8.4 0 0 1 2 11.7l5 3.7 17.9-24.7a33.2 33.2 0 0 0 6.3-19.5 33.8 33.8 0 0 0-.4-5.4 33.2 33.2 0 0 0-13.4-21.7l-33.8-24.6a8.3 8.3 0 0 1-3.4-5.4 8.8 8.8 0 0 1 0-1.4 8.2 8.2 0 0 1 1.5-4.8l-5-3.7zM87.3 38A48 48 0 0 0 78 66.2a49.2 49.2 0 0 0 .6 7.7A48.1 48.1 0 0 0 98 105.5l42.5 30.8a25.8 25.8 0 0 1 10.4 16.9 26.4 26.4 0 0 1 .3 4.1 25.8 25.8 0 0 1-5 15.2l4.1 3 33.5-46.3A48.4 48.4 0 0 0 173 61.6l-51.3-37.3a15 15 0 0 1-3.3-20.9l-4-2.9zM.5 285.8h38.7c9.5 0 17 2.6 21.8 7.3a19.1 19.1 0 0 1 5.7 14.2v.2c0 9.4-5 14.7-11 18 9.6 3.7 15.6 9.3 15.6 20.5v.2c0 15.3-12.4 22.9-31.2 22.9H.5zm34.8 33.6c8 0 13.2-2.6 13.2-8.8v-.2c0-5.5-4.3-8.6-12-8.6H18.4v17.6zm4.9 33.6c8 0 13-2.8 13-9v-.2c0-5.6-4.2-9-13.6-9H18.4V353zm39.1-67.3H118c9.6 0 17 2.7 21.8 7.4a19.1 19.1 0 0 1 5.7 14.2v.2c0 9.4-5 14.7-11 18 9.7 3.7 15.6 9.3 15.6 20.5v.2c0 15.3-12.4 22.9-31.2 22.9H79.3zm34.8 33.8c8 0 13.2-2.7 13.2-8.9v-.2c0-5.5-4.2-8.6-12-8.6H97.2v17.6zM119 353c8 0 13-2.8 13-9v-.2c0-5.6-4.2-9-13.6-9H97.2V353zm39.1-67.3H197c9.5 0 17 2.7 21.7 7.4a19.1 19.1 0 0 1 5.8 14.2v.2c0 9.4-5 14.7-11 18 9.6 3.7 15.6 9.3 15.6 20.5v.2c0 15.3-12.4 22.9-31.2 22.9h-39.6zm34.8 33.8c8.1 0 13.2-2.7 13.2-8.9v-.2c0-5.5-4.2-8.6-12-8.6h-18v17.6zm4.9 33.5c8.1 0 13-2.8 13-9v-.2c0-5.6-4.2-9-13.6-9H176V353zm35-1.3v-.1a17 17 0 0 1 34-.1 17 17 0 0 1-34 .2zm32-.1v-.1a15 15 0 1 0-30 0v.2a15 15 0 1 0 30-.1zm-22-9.5h8a7.6 7.6 0 0 1 5.6 2 5.4 5.4 0 0 1 1.6 4 5.6 5.6 0 0 1-4 5.6l4.5 6.4h-4.7l-3.8-5.8h-3.2v5.8h-4zm8 8.8c2 0 3.2-1 3.2-2.6 0-1.8-1.3-2.7-3.2-2.7h-4v5.3z"
            />
          </svg>
        </div>
        <div class="text-center flex-1">
          <div class="text-xs sm:text-sm text-muted-foreground/80 font-medium">
            Better Business Bureau
          </div>
          <div
            class="text-base sm:text-lg font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent"
          >
            Business Information Form
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 py-4 sm:py-8">
  <div class="container mx-auto max-w-4xl px-3 sm:px-4 lg:px-6">
    <!-- Form -->
    <div
      hlmCard
      class="p-3 sm:p-6 bbb-shadow-base bg-gradient-to-r from-card/90 to-card/80 backdrop-blur-sm border border-border/50 shadow-xl"
    >
      <form [formGroup]="accreditationForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Business Information Section -->
        <div class="space-y-4 sm:space-y-6">
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">Business Information</div>
              <div hlmCardDescription>Tell us about your business and where it's located.</div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <div class="bg-muted/40 border-l-4 border-primary p-3 sm:p-4 rounded-r-lg">
                <p class="text-sm sm:text-base text-muted-foreground">
                  This form is designed to help collect important information about your business
                  for the
                  <span class="font-semibold text-primary">Better Business Bureau® (BBB)</span>. The
                  details you provide will allow us to understand your business and determine if you
                  may be ready for BBB Accreditation. Please note: completing this form does not
                  constitute an application for Accreditation, nor does it guarantee approval.
                  Instead, this information helps us evaluate whether your business meets BBB's
                  standards for trust, ethics, and marketplace integrity.
                </p>
              </div>
              <hlm-form-field>
                <label hlmLabel>Business Name *</label>
                <input
                  hlmInput
                  type="text"
                  placeholder="ABC Roofing Inc."
                  formControlName="businessName"
                />
                <hlm-error>Business name is required</hlm-error>
              </hlm-form-field>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Business Address *</label>
                  <input hlmInput placeholder="123 Main St" formControlName="businessAddress" />
                  <hlm-error>Business address is required</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Business Apt/Suite Number</label>
                  <input
                    hlmInput
                    placeholder="Apt 2B, Suite 100"
                    formControlName="businessAptSuite"
                  />
                </hlm-form-field>
              </div>

              <hlm-form-field>
                <label hlmLabel>Business City *</label>
                <input hlmInput placeholder="Los Angeles" formControlName="businessCity" />
                <hlm-error>City is required</hlm-error>
              </hlm-form-field>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Business State *</label>
                  <brn-select
                    class="inline-block w-full"
                    placeholder="Select a state"
                    formControlName="businessState"
                  >
                    <hlm-select-trigger class="w-full">
                      <hlm-select-value />
                    </hlm-select-trigger>
                    <hlm-select-content class="max-h-56">
                      @for (state of states; track $index) {
                      <hlm-option value="{{ state }}">{{ state }}</hlm-option>
                      }
                    </hlm-select-content>
                  </brn-select>

                  <hlm-error>State is required</hlm-error>
                  <hlm-hint class="italic text-xs"
                    >If your primary business address is a mailbox, virtual office or co-working
                    space, our vetting team will reach out to you for a physical address.</hlm-hint
                  >
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Business ZIP Code *</label>
                  <input type="number" hlmInput placeholder="90001" formControlName="businessZip" />
                  <hlm-error>ZIP Code is required</hlm-error>
                  <hlm-hint class="italic text-xs"
                    >If your primary business address is a mailbox, virtual office or co-working
                    space, our vetting team will reach out to you for a physical address.</hlm-hint
                  >
                </hlm-form-field>
              </div>

              <hlm-form-field>
                <label hlmLabel>Doing Business As (DBA)</label>
                <input hlmInput placeholder="ABC Contractors" formControlName="doingBusinessAs" />
              </hlm-form-field>

              <!-- Mailing Address Section -->
              <div class="space-y-3 sm:space-y-4">
                <div class="flex items-center space-x-2">
                  <hlm-checkbox formControlName="sameAsBusinessAddress" />
                  <label hlmLabel class="text-sm font-medium text-gray-700 dark:text-gray-300">
                    Use business address as mailing address
                  </label>
                </div>

                @if (!accreditationForm.get('sameAsBusinessAddress')?.value) {
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                  <hlm-form-field>
                    <label hlmLabel>Mailing Address *</label>
                    <input hlmInput placeholder="PO Box 456" formControlName="mailingAddress" />
                    <hlm-error> Mailing address is required </hlm-error>
                  </hlm-form-field>

                  <hlm-form-field>
                    <label hlmLabel>Mailing Apt/Suite Number</label>
                    <input
                      hlmInput
                      placeholder="Apt 2B, Suite 100"
                      formControlName="mailingAptSuite"
                    />
                  </hlm-form-field>
                </div>

                <hlm-form-field>
                  <label hlmLabel>Mailing City *</label>
                  <input hlmInput placeholder="Los Angeles" formControlName="mailingCity" />
                  <hlm-error> City is required </hlm-error>
                </hlm-form-field>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                  <hlm-form-field>
                    <label hlmLabel>Mailing State *</label>
                    <brn-select
                      class="inline-block w-full"
                      placeholder="Select a state"
                      formControlName="mailingState"
                    >
                      <hlm-select-trigger class="w-full">
                        <hlm-select-value />
                      </hlm-select-trigger>
                      <hlm-select-content class="max-h-56">
                        @for (state of states; track $index) {
                        <hlm-option value="{{ state }}">{{ state }}</hlm-option>
                        }
                      </hlm-select-content>
                    </brn-select>

                    <hlm-error> State is required </hlm-error>
                  </hlm-form-field>
                  <hlm-form-field>
                    <label hlmLabel>Mailing ZIP Code *</label>
                    <input
                      type="number"
                      hlmInput
                      placeholder="90001"
                      formControlName="mailingZip"
                    />
                    <hlm-error> ZIP Code is required </hlm-error>
                  </hlm-form-field>
                </div>
                }
              </div>

              <!-- Multiple Locations Section -->
              <div class="space-y-3 sm:space-y-4">
                <div class="flex items-center space-x-2">
                  <hlm-checkbox formControlName="hasMultipleLocations" />
                  <label hlmLabel class="text-sm font-medium text-gray-700 dark:text-gray-300">
                    This business has more than 1 location.
                  </label>
                </div>

                @if (accreditationForm.get('hasMultipleLocations')?.value) {
                <hlm-form-field>
                  <label hlmLabel
                    >How many locations would you like to be considered for BBB Accreditation?
                    *</label
                  >
                  <input
                    type="number"
                    hlmInput
                    placeholder="Enter number of locations"
                    formControlName="numberOfLocations"
                  />
                  <hlm-error>Number of locations is required</hlm-error>
                </hlm-form-field>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Business Contact Information Section -->
        <div class="space-y-4 sm:space-y-6">
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">
                Business Contact Information
              </div>
              <div hlmCardDescription>
                Primary business contact details and communication preferences.
              </div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Primary Business Phone *</label>
                  <input
                    type="number"
                    hlmInput
                    placeholder="1234567890"
                    formControlName="primaryBusinessPhone"
                  />
                  <hlm-error>Primary business phone is required or invalid phone number</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Primary Business Email *</label>
                  <input
                    hlmInput
                    placeholder="info@abcroofing.com"
                    type="email"
                    formControlName="primaryBusinessEmail"
                  />
                  <hlm-error>Primary business email is required or invalid email</hlm-error>
                </hlm-form-field>
              </div>

              <hlm-form-field>
                <label hlmLabel>Email to receive quote requests from customers</label>
                <input
                  hlmInput
                  placeholder="quotes@abcroofing.com"
                  type="email"
                  formControlName="emailToReceiveQuoteRequestsFromCustomers"
                />
                <hlm-error>Invalid email</hlm-error>
              </hlm-form-field>

              <hlm-form-field>
                <label hlmLabel>Website</label>
                <input
                  hlmInput
                  placeholder="https://www.abcroofing.com"
                  type="url"
                  formControlName="website"
                />
              </hlm-form-field>

              <!-- Social Media Links Section -->
              <div class="space-y-3">
                <div class="flex items-center justify-between">
                  <label hlmLabel class="text-sm font-medium text-gray-700 dark:text-gray-300"
                    >Additional URLs</label
                  >
                  <button
                    type="button"
                    hlmBtn
                    variant="outline"
                    size="sm"
                    (click)="addSocialMediaLink()"
                    class="flex items-center gap-2"
                  >
                    <ng-icon hlm name="lucidePlus" size="sm" />
                    Add URL
                  </button>
                </div>

                <div formArrayName="socialMediaLinks" class="space-y-3">
                  @for (link of socialMediaLinks.controls; track $index) {
                  <div class="flex items-start gap-2">
                    <hlm-form-field class="flex-1">
                      <input
                        hlmInput
                        placeholder="https://www.facebook.com/yourbusiness"
                        type="url"
                        [formControlName]="$index"
                      />
                      <hlm-error>Social media link is required</hlm-error>
                    </hlm-form-field>
                    <button
                      type="button"
                      hlmBtn
                      variant="outline"
                      (click)="removeSocialMediaLink($index)"
                      class="text-destructive hover:text-destructive"
                    >
                      <ng-icon hlm name="lucideTrash2" size="sm" />
                    </button>
                  </div>
                  }
                </div>
              </div>
            </div>
          </div>

          <!-- Primary Contact Section -->
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">
                Company's principal/owner
              </div>
              <div hlmCardDescription>Main point of contact for your business.</div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>First Name *</label>
                  <input hlmInput placeholder="John" formControlName="primaryFirstName" />
                  <hlm-error>First name is required</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Last Name *</label>
                  <input hlmInput placeholder="Doe" formControlName="primaryLastName" />
                  <hlm-error>Last name is required</hlm-error>
                </hlm-form-field>
              </div>
              <hlm-form-field>
                <label hlmLabel>Title *</label>
                <input hlmInput placeholder="Owner" formControlName="primaryTitle" />
                <hlm-error>Title is required</hlm-error>
              </hlm-form-field>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <div>
                  <label for="primaryDateOfBirth" hlmLabel class="px-1">Date of birth *</label>
                  <input
                    hlmInput
                    type="date"
                    class="w-full mt-2"
                    formControlName="primaryDateOfBirth"
                    placeholder="Select a date"
                    [max]="today"
                  />

                  @if ( accreditationForm.get('primaryDateOfBirth')?.touched &&
                  accreditationForm.get('primaryDateOfBirth')?.errors?.['required'] ) {
                  <hlm-error class="mt-1">Date of birth is required</hlm-error>
                  }
                </div>
                <hlm-form-field>
                  <label hlmLabel>Contact Email *</label>
                  <input
                    hlmInput
                    placeholder="john@abcroofing.com"
                    type="email"
                    formControlName="primaryContactEmail"
                  />
                  <hlm-error>Contact email is required or invalid email</hlm-error>
                </hlm-form-field>
              </div>

              <hlm-form-field>
                <label hlmLabel>Contact Phone Number *</label>
                <input
                  type="number"
                  hlmInput
                  placeholder="1234567890"
                  formControlName="primaryContactNumber"
                />
                <hlm-error>Contact phone number is required or invalid phone number</hlm-error>
              </hlm-form-field>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Preferred Contact Method *</label>
                  <brn-select
                    class="inline-block w-full"
                    placeholder="Select some methods"
                    formControlName="preferredContactMethod"
                  >
                    <hlm-select-trigger class="w-full">
                      <hlm-select-value />
                    </hlm-select-trigger>
                    <hlm-select-content>
                      <hlm-option value="Email">Email</hlm-option>
                      <hlm-option value="Phone">Phone</hlm-option>
                      <hlm-option value="SMS">SMS</hlm-option>
                      <hlm-option value="Video Call">Video Call</hlm-option>
                    </hlm-select-content>
                  </brn-select>
                  <hlm-error>Preferred contact method is required</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Contact Types</label>
                  <brn-select
                    class="inline-block w-full"
                    placeholder="Select some types"
                    [multiple]="true"
                    formControlName="primaryContactTypes"
                  >
                    <hlm-select-trigger class="w-full">
                      <hlm-select-value />
                    </hlm-select-trigger>
                    <hlm-select-content>
                      <hlm-option value="Primary">Primary</hlm-option>
                      <hlm-option value="Billing">Billing</hlm-option>
                      <hlm-option value="Marketing">Marketing</hlm-option>
                      <hlm-option value="Complaint Handler">Complaint Handler</hlm-option>
                      <hlm-option value="Customer Reviews">Customer Reviews</hlm-option>
                      <hlm-option value="Business Profile">List on Business Profile</hlm-option>
                      <hlm-option value="Company Management">Company Management</hlm-option>
                    </hlm-select-content>
                  </brn-select>
                </hlm-form-field>
              </div>
            </div>
          </div>

          <!-- Secondary Contact Section -->
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">
                Secondary Contact (Optional)
              </div>
              <div hlmCardDescription>Additional contact person for your business operations.</div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>First Name</label>
                  <input hlmInput placeholder="Jane" formControlName="secondaryFirstName" />
                  <hlm-error>First name is required</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Last Name</label>
                  <input hlmInput placeholder="Smith" formControlName="secondaryLastName" />
                  <hlm-error>Last name is required</hlm-error>
                </hlm-form-field>

                <hlm-form-field>
                  <label hlmLabel>Title</label>
                  <input hlmInput placeholder="Owner" formControlName="secondaryTitle" />
                  <hlm-error>Title is required</hlm-error>
                </hlm-form-field>

                <hlm-form-field>
                  <label hlmLabel>Email</label>
                  <input
                    hlmInput
                    placeholder="jane@abcroofing.com"
                    type="email"
                    formControlName="secondaryEmail"
                  />
                  <hlm-error
                    >Email is required or invalid email or email is already in use</hlm-error
                  >
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Phone Number</label>
                  <input
                    type="number"
                    hlmInput
                    placeholder="1234567890"
                    formControlName="secondaryPhone"
                  />
                  <hlm-error
                    >Phone number is required or phone number is already in use or invalid phone
                    number</hlm-error
                  >
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Preferred Contact Method</label>
                  <brn-select
                    class="inline-block w-full"
                    placeholder="Select some methods"
                    formControlName="secondaryPreferredContactMethod"
                  >
                    <hlm-select-trigger class="w-full">
                      <hlm-select-value />
                    </hlm-select-trigger>
                    <hlm-select-content>
                      <hlm-option value="Email">Email</hlm-option>
                      <hlm-option value="Phone">Phone</hlm-option>
                      <hlm-option value="SMS">SMS</hlm-option>
                      <hlm-option value="Video Call">Video Call</hlm-option>
                    </hlm-select-content>
                  </brn-select>
                  <hlm-error>Preferred contact method is required</hlm-error>
                </hlm-form-field>
              </div>
              <hlm-form-field>
                <label hlmLabel>Contact Types</label>
                <brn-select
                  class="inline-block w-full"
                  placeholder="Select some types"
                  [multiple]="true"
                  formControlName="secondaryContactTypes"
                >
                  <hlm-select-trigger class="w-full">
                    <hlm-select-value />
                  </hlm-select-trigger>
                  <hlm-select-content>
                    <hlm-option value="Billing">Billing</hlm-option>
                    <hlm-option value="Marketing">Marketing</hlm-option>
                    <hlm-option value="Complaint Handler">Complaint Handler</hlm-option>
                    <hlm-option value="Customer Reviews">Customer Reviews</hlm-option>
                    <hlm-option value="Business Profile">List on Business Profile</hlm-option>
                    <hlm-option value="Company Management">Company Management</hlm-option>
                  </hlm-select-content>
                </brn-select>
              </hlm-form-field>
            </div>
          </div>
        </div>

        <!-- Business Details Section -->
        <div class="space-y-4 sm:space-y-6">
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">Business Details</div>
              <div hlmCardDescription>
                Tell us more about your business operations and legal information.
              </div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <hlm-form-field>
                <label hlmLabel>Business Description *</label>
                <textarea
                  hlmInput
                  placeholder="We provide residential and commercial roofing services including installations, repairs, and inspections."
                  class="min-h-[100px]"
                  formControlName="businessDescription"
                ></textarea>
                <hlm-error>Business description is required</hlm-error>
              </hlm-form-field>
              <hlm-form-field class="mt-4">
                <label hlmLabel>Business Service Area *</label>
                <textarea
                  hlmInput
                  placeholder="City, County, State"
                  class="min-h-[100px]"
                  formControlName="businessServiceArea"
                ></textarea>
                <hlm-error>Business service area is required</hlm-error>
                <hlm-hint class="mt-2 italic text-xs"
                  >Please list all service areas for your business, specifying county, city, and
                  state for each location.</hlm-hint
                >
              </hlm-form-field>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>EIN (Employer Identification Number)</label>
                  <input hlmInput placeholder="12-3456789" formControlName="ein" />
                </hlm-form-field>
                <div>
                  <label hlmLabel class="mb-2">Type of Business *</label>
                  <brn-popover
                    [state]="state()"
                    (stateChanged)="stateChanged($event)"
                    sideOffset="5"
                    class="w-full"
                  >
                    <button
                      #businessTypeTrigger
                      type="button"
                      [class]="
                        'w-full justify-between font-normal text-sm bg-background/50 border-border/60 focus:border-primary/50 focus:ring-primary/20  transition-all duration-200 inline-flex items-center px-3 py-2' +
                        (accreditationForm.get('businessType')?.invalid &&
                        accreditationForm.get('businessType')?.touched
                          ? ' !border-destructive !border-1'
                          : '')
                      "
                      id="edit-profile"
                      variant="outline"
                      brnPopoverTrigger
                      (click)="state.set('open')"
                      hlmBtn
                    >
                      {{ currentTob() ? currentTob()?.name : 'Select Type of Business...' }}
                      <ng-icon hlm size="sm" name="lucideChevronsUpDown" class="opacity-50" />
                    </button>
                    <hlm-command
                      *brnPopoverContent="let ctx"
                      hlmPopoverContent
                      class="p-0 [&_button:hover]:!text-black"
                      [style.width.px]="getBusinessTypeTriggerWidth()"
                    >
                      <hlm-command-search>
                        <ng-icon hlm name="lucideSearch" />
                        <input
                          placeholder="Search Type of Business..."
                          class="placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none disabled:cursor-not-allowed disabled:opacity-50"
                          (input)="commandSearch($event.target.value)"
                        />
                      </hlm-command-search>
                      <div *brnCommandEmpty hlmCommandEmpty>No results found.</div>
                      <hlm-command-list>
                        <hlm-command-group>
                          @for (tob of tobItems(); track tob.cbbbId) {
                          <button
                            type="button"
                            hlm-command-item
                            [value]="tob.cbbbId"
                            (selected)="commandSelected(tob)"
                            class="hover:!text-black"
                            style="--hover-text-color: black"
                          >
                            <span>{{ tob.name }}</span>
                            <ng-icon
                              hlm
                              class="ml-auto"
                              [class.opacity-0]="currentTob()?.cbbbId !== tob.cbbbId"
                              name="lucideCheck"
                              hlmCommandIcon
                            />
                          </button>
                          }
                        </hlm-command-group>
                      </hlm-command-list>
                    </hlm-command>
                  </brn-popover>
                  @if (accreditationForm.get('businessType')?.invalid &&
                  accreditationForm.get('businessType')?.touched) {
                  <hlm-error class="mt-2">Type of business is required</hlm-error>
                  }
                </div>
              </div>

              <div>
                <label hlmLabel class="mb-2">Secondary Business Types</label>
                <brn-popover
                  [state]="secondaryState()"
                  (stateChanged)="secondaryStateChanged($event)"
                  sideOffset="5"
                  class="w-full"
                >
                  <button
                    #secondaryBusinessTypeTrigger
                    type="button"
                    class="w-full justify-between font-normal text-sm bg-background/50 border-border/60 focus:border-primary/50 focus:ring-primary/20 transition-all duration-200 inline-flex items-center px-3 py-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    variant="outline"
                    brnPopoverTrigger
                    (click)="secondaryState.set('open')"
                    hlmBtn
                    [disabled]="!isBusinessTypeSelected()"
                  >
                    {{ getSecondaryTobsDisplayText() }}
                    <ng-icon hlm size="sm" name="lucideChevronsUpDown" class="opacity-50" />
                  </button>
                  <hlm-command
                    *brnPopoverContent="let ctx"
                    hlmPopoverContent
                    class="p-0 [&_button:hover]:!text-black"
                    [style.width.px]="getSecondaryBusinessTypeTriggerWidth()"
                  >
                    <hlm-command-search>
                      <ng-icon hlm name="lucideSearch" />
                      <input
                        placeholder="Search Type of Business..."
                        class="placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none disabled:cursor-not-allowed disabled:opacity-50"
                        [value]="secondarySearchValue()"
                        (input)="secondaryCommandSearch($event.target.value)"
                      />
                    </hlm-command-search>
                    <div *brnCommandEmpty hlmCommandEmpty>No results found.</div>
                    <hlm-command-list>
                      <hlm-command-group>
                        @for (tob of getSecondaryTobItems(); track tob.cbbbId) {
                        <button
                          type="button"
                          hlm-command-item
                          [value]="tob.cbbbId"
                          (selected)="secondaryCommandSelected(tob)"
                          class="hover:!text-black"
                          style="--hover-text-color: black"
                        >
                          <span>{{ tob.name }}</span>
                          <ng-icon
                            hlm
                            class="ml-auto"
                            [class.opacity-0]="!isSecondaryTobSelected(tob.cbbbId)"
                            name="lucideCheck"
                            hlmCommandIcon
                          />
                        </button>
                        }
                      </hlm-command-group>
                    </hlm-command-list>
                  </hlm-command>
                </brn-popover>

                @if (selectedSecondaryTobs().length > 0) {
                <div class="mt-3 flex flex-wrap gap-2">
                  @for (tob of selectedSecondaryTobs(); track tob.cbbbId) {
                  <span
                    class="inline-flex items-center gap-1.5 rounded-full bg-primary/10 text-primary px-3 py-1.5 text-xs font-medium border border-primary/20"
                  >
                    <span>{{ tob.name }}</span>
                    <button
                      type="button"
                      class="ml-0.5 inline-flex h-4 w-4 shrink-0 items-center justify-center rounded-full hover:bg-primary/20 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1"
                      (click)="removeSecondaryTob(tob)"
                      [attr.aria-label]="'Remove ' + tob.name"
                    >
                      <ng-icon hlm name="lucideX" size="sm" />
                    </button>
                  </span>
                  }
                </div>
                }
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <div>
                  <label for="businessStartDate" hlmLabel class="px-1">Business Start Date *</label>
                  <input
                    hlmInput
                    type="date"
                    class="w-full mt-2"
                    formControlName="businessStartDate"
                    placeholder="Select a date"
                  />

                  @if ( accreditationForm.get('businessStartDate')?.touched &&
                  accreditationForm.get('businessStartDate')?.errors?.['required'] ) {
                  <hlm-error class="mt-1">Business start date is required</hlm-error>
                  }
                </div>
                <hlm-form-field>
                  <label hlmLabel>Business Entity Type *</label>
                  <brn-select
                    class="inline-block w-full"
                    placeholder="Select entity types"
                    formControlName="businessEntityType"
                  >
                    <hlm-select-trigger class="w-full">
                      <hlm-select-value />
                    </hlm-select-trigger>
                    <hlm-select-content class="max-h-56">
                      @for (entityType of entityTypes; track entityType) {
                      <hlm-option value="{{ entityType }}">{{ entityType }}</hlm-option>
                      }
                    </hlm-select-content>
                  </brn-select>
                  <hlm-error>Business entity type is required</hlm-error>
                </hlm-form-field>
              </div>
            </div>
          </div>

          <!-- Licenses Section -->
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">
                Licenses & Certifications
              </div>
              <div hlmCardDescription>
                Please add your state business license or professional licenses below.
              </div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <!-- Add License Button -->
              <div class="flex items-center justify-between">
                <label hlmLabel class="text-sm font-medium text-gray-700 dark:text-gray-300"
                  >Licenses</label
                >
                <button
                  type="button"
                  hlmBtn
                  variant="outline"
                  size="sm"
                  (click)="addLicense()"
                  class="flex items-center gap-2"
                >
                  <ng-icon hlm name="lucidePlus" size="sm" />
                  Add License
                </button>
              </div>

              <!-- Dynamic License Fields -->
              <div formArrayName="licenses" class="space-y-4">
                @for (license of licenses.controls; track $index) {
                <div
                  class="border border-gray-200 rounded-lg p-4 space-y-3"
                  [formGroupName]="$index"
                >
                  <div class="flex items-center justify-between">
                    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">
                      License {{ $index + 1 }}
                    </h4>
                    <button
                      type="button"
                      hlmBtn
                      variant="outline"
                      size="sm"
                      (click)="removeLicense($index)"
                      class="text-destructive hover:text-destructive"
                    >
                      <ng-icon hlm name="lucideTrash2" size="sm" />
                    </button>
                  </div>

                  <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                    <hlm-form-field>
                      <label hlmLabel>Licensing Number *</label>
                      <input
                        hlmInput
                        placeholder="CA-987654321"
                        formControlName="licensingNumber"
                      />
                      <hlm-error>Licensing number is required</hlm-error>
                    </hlm-form-field>
                    <hlm-form-field>
                      <label hlmLabel>Agency *</label>
                      <input
                        hlmInput
                        placeholder="CSLB (Contractors State License Board)"
                        formControlName="agency"
                      />
                      <hlm-error>Agency is required</hlm-error>
                    </hlm-form-field>
                  </div>

                  <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                      <label hlmLabel class="px-1">Date Issued *</label>
                      <input
                        hlmInput
                        type="date"
                        class="w-full mt-2"
                        formControlName="dateIssued"
                        placeholder="Select a date"
                      />

                      @if ( license.get('dateIssued')?.touched &&
                      license.get('dateIssued')?.errors?.['required'] ) {
                      <hlm-error class="mt-1">Date issued is required</hlm-error>
                      }
                    </div>
                    <div>
                      <label hlmLabel class="px-1">Expiration</label>
                      <input
                        hlmInput
                        type="date"
                        class="w-full mt-2"
                        formControlName="expiration"
                        placeholder="Select a date"
                      />
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
          </div>

          <!-- Business Scale Section -->
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">
                Business Scale & Operations
              </div>
              <div hlmCardDescription>Information about your business size and customer base.</div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Number of Full Time Employees *</label>
                  <input
                    type="number"
                    hlmInput
                    placeholder="10"
                    formControlName="numberOfFullTimeEmployees"
                  />
                  <hlm-error>Number of full time employees is required</hlm-error>
                </hlm-form-field>

                <hlm-form-field>
                  <label hlmLabel>Number of Part Time Employees</label>
                  <input
                    type="number"
                    hlmInput
                    placeholder="10"
                    formControlName="numberOfPartTimeEmployees"
                  />
                </hlm-form-field>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Gross Annual Revenue *</label>
                  <input
                    type="number"
                    hlmInput
                    placeholder="100000"
                    formControlName="grossAnnualRevenue"
                  />
                  <hlm-error>Gross annual revenue is required</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Average Customers Per Year *</label>
                  <brn-select
                    class="inline-block w-full"
                    placeholder="Select customer range"
                    formControlName="avgCustomersPerYear"
                  >
                    <hlm-select-trigger class="w-full">
                      <hlm-select-value />
                    </hlm-select-trigger>
                    <hlm-select-content class="max-h-56">
                      @for (range of ranges; track range) {
                      <hlm-option value="{{ range }}">{{ range }}</hlm-option>
                      }
                    </hlm-select-content>
                  </brn-select>
                  <hlm-error>Average customers per year is required</hlm-error>
                </hlm-form-field>
              </div>
            </div>
          </div>

          <!-- Additional Business Information Section -->
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary">
                Additional Business Information
              </div>
              <div hlmCardDescription>
                Any additional details that would help us better understand your business.
              </div>
            </div>
            <div hlmCardContent class="space-y-3 sm:space-y-4">
              <hlm-form-field>
                <label hlmLabel>Additional Information</label>
                <textarea
                  hlmInput
                  class="min-h-[100px]"
                  placeholder="type your additional information here"
                  formControlName="additionalBusinessInformation"
                ></textarea>
                <hlm-hint class="mt-2 italic text-xs"
                  >Examples: Has your business been purchased recently? Does your business require a
                  competency license?</hlm-hint
                >
              </hlm-form-field>
            </div>
          </div>
        </div>

        <!-- Agreement Section -->
        <div class="space-y-4 sm:space-y-6">
          <div hlmCard>
            <div hlmCardHeader>
              <div hlmCardTitle class="text-lg sm:text-xl text-primary flex items-center gap-2">
                <ng-icon name="lucideShield" class="h-4 w-4 sm:h-5 sm:w-5" />
                Confirmation of Information
              </div>
              <div hlmCardDescription>Review your information and confirm accuracy.</div>
            </div>
            <div hlmCardContent class="space-y-4 sm:space-y-6">
              <div class="flex items-start gap-2 sm:gap-3">
                <hlm-checkbox formControlName="principalContactAgreement" />
                <label hlmLabel>I am the principal contact</label>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                <hlm-form-field>
                  <label hlmLabel>Full Name *</label>
                  <input hlmInput placeholder="John Doe" formControlName="submittedByName" />
                  <hlm-error>Name is required</hlm-error>
                </hlm-form-field>
                <hlm-form-field>
                  <label hlmLabel>Title *</label>
                  <input hlmInput placeholder="Owner" formControlName="submittedByTitle" />
                  <hlm-error>Title is required</hlm-error>
                </hlm-form-field>
              </div>
              <hlm-form-field>
                <label hlmLabel>Email *</label>
                <input
                  hlmInput
                  placeholder="john@abcroofing.com"
                  formControlName="submittedByEmail"
                />
                <hlm-error>Email is required or invalid email</hlm-error>
              </hlm-form-field>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end pt-6 border-t border-border/50">
          <button
            hlmBtn
            type="submit"
            class="bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg transition-all duration-200"
          >
            Submit Information
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Enhanced Footer -->
<footer
  class="mt-12 bg-gradient-to-t from-muted/60 via-muted/40 to-background border-t border-border/50 shadow-lg backdrop-blur-sm relative"
>
  <!-- Background decoration -->
  <div
    class="absolute inset-0 bg-gradient-to-r from-primary/3 via-transparent to-accent/3 opacity-50"
  ></div>

  <div class="container mx-auto max-w-4xl px-3 sm:px-4 lg:px-6 py-6 sm:py-8 relative">
    <div class="grid grid-cols-1 sm:grid-cols-[auto,1fr] gap-3 sm:gap-4 items-start">
      <div
        class="flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 text-primary border border-primary/20 shadow-sm"
      >
        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path
            fill-rule="evenodd"
            d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div>
        <h3 class="text-sm font-semibold text-foreground mb-2 flex items-center gap-2">
          <span class="w-1 h-1 bg-primary rounded-full"></span>
          Important Notice
        </h3>
        <p class="text-sm text-muted-foreground leading-relaxed">
          Submission of this Business Information Form does not constitute an application for
          <span class="font-semibold text-foreground">BBB® Accreditation</span> or guarantee of
          approval. Information provided will be used solely to determine if your business meets the
          standards required to be considered for BBB Accreditation.
        </p>
      </div>
    </div>
  </div>
</footer>
